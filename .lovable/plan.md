

## ĞŸĞ»Ğ°Ğ½: Ğ ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ²ĞºĞ»Ğ°Ğ´ĞµĞ½Ğ¸Ñ… ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ² (Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ– Ğ½Ğ° ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–) Ñƒ ÑÑ‚Ğ¸Ğ»Ñ– Facebook

---

### ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚Ğ°Ğ½

Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ `comments` Ğ¼Ğ°Ñ” Ñ‚Ğ°ĞºÑ– Ğ¿Ğ¾Ğ»Ñ:
- `id` - UUID
- `post_id` - Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ Ğ½Ğ° Ğ¿Ğ¾ÑÑ‚
- `user_id` - Ğ°Ğ²Ñ‚Ğ¾Ñ€ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ
- `content` - Ñ‚ĞµĞºÑÑ‚
- `created_at` - Ğ´Ğ°Ñ‚Ğ° ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ

**ĞĞµĞ¼Ğ°Ñ” Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ»Ñ Ğ·Ğ²'ÑĞ·ĞºÑƒ Ğ· Ğ±Ğ°Ñ‚ÑŒĞºÑ–Ğ²ÑÑŒĞºĞ¸Ğ¼ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€ĞµĞ¼.**

---

### ĞÑ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€Ñ–ÑˆĞµĞ½Ğ½Ñ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ĞšĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€ 1 (parent_id = NULL)               â”‚
â”‚ ğŸ‘¤ Ğ’Ğ°Ğ»ĞµĞ½Ñ‚Ğ¸Ğ½Ğ° ĞŸÑƒÑˆĞºĞ°Ñ€                          â”‚
â”‚ "Ğ¡Ğ°ÑˆĞ° Ğ½Ğ° Ñ†Ğ¸Ñ… Ñ„Ğ¾Ñ‚Ğ¾ ÑÑ…Ğ¾Ğ¶Ğ¸Ğ¹ Ğ½Ğ° Ğ¤Ğ Ğ•Ğ”Ğ˜"          â”‚
â”‚ [ĞŸĞ¾Ğ´Ğ¾Ğ±Ğ°Ñ”Ñ‚ÑŒÑÑ] [Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–ÑÑ‚Ğ¸]                  â”‚
â”‚                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ (parent_id = ĞšĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€ 1)  â”‚   â”‚
â”‚   â”‚ ğŸ‘¤ ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€ Ğ”Ñ–Ğ´Ğ¸Ğº                   â”‚   â”‚
â”‚   â”‚ "Ğ‘ÑƒĞ»Ğ° Ñ‚Ğ°ĞºĞ° Ğ³Ñ–Ñ‚Ğ°Ñ€Ğ°? Ğ£Ñ€Ğ°Ğ»?"           â”‚   â”‚
â”‚   â”‚ [ĞŸĞ¾Ğ´Ğ¾Ğ±Ğ°Ñ”Ñ‚ÑŒÑÑ] [Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–ÑÑ‚Ğ¸]          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ (parent_id = ĞšĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€ 1)  â”‚   â”‚
â”‚   â”‚ ğŸ”‘ ĞĞ²Ñ‚Ğ¾Ñ€                             â”‚   â”‚
â”‚   â”‚ ğŸ‘¤ ĞĞ»ĞµĞºÑĞ°Ğ½Ğ´Ñ€ Ğ‘Ğ¾Ğ´Ğ½Ğ°Ñ€ÑĞº               â”‚   â”‚
â”‚   â”‚ "Ğ£ ÑÑ–Ğ»ÑŒÑÑŒĞºĞ¸Ñ… ĞºĞ»ÑƒĞ±Ğ°Ñ…..."             â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 1: Ğ—Ğ¼Ñ–Ğ½Ğ¸ Ğ² Ğ±Ğ°Ğ·Ñ– Ğ´Ğ°Ğ½Ğ¸Ñ…

#### Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºÑƒ `parent_id` Ğ´Ğ¾ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñ– comments

```sql
-- Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºÑƒ parent_id Ğ´Ğ»Ñ Ğ²ĞºĞ»Ğ°Ğ´ĞµĞ½Ğ¸Ñ… ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ²
ALTER TABLE public.comments 
ADD COLUMN parent_id uuid REFERENCES public.comments(id) ON DELETE CASCADE;

-- Ğ†Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ ÑˆĞ²Ğ¸Ğ´ĞºĞ¾Ğ³Ğ¾ Ğ¿Ğ¾ÑˆÑƒĞºÑƒ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ĞµĞ¹
CREATE INDEX idx_comments_parent_id ON public.comments(parent_id);
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 2: ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ TypeScript Ñ‚Ğ¸Ğ¿Ğ¸

Ğ¤Ğ°Ğ¹Ğ»: `src/integrations/supabase/types.ts`

```typescript
comments: {
  Row: {
    content: string
    created_at: string | null
    id: string
    post_id: string
    user_id: string
    parent_id: string | null  // â† Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸
  }
  Insert: {
    content: string
    created_at?: string | null
    id?: string
    post_id: string
    user_id: string
    parent_id?: string | null  // â† Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸
  }
  Update: {
    content?: string
    created_at?: string | null
    id?: string
    post_id?: string
    user_id?: string
    parent_id?: string | null  // â† Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸
  }
}
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 3: ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ñ–Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ CommentData

Ğ¤Ğ°Ğ¹Ğ»: `src/components/feed/PostCard.tsx`

```typescript
interface CommentData {
  id: string;
  content: string;
  created_at: string;
  user_id: string;
  parent_id?: string | null;  // â† Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸
  user?: {
    id: string;
    full_name: string;
    avatar_url: string;
  };
  replies?: CommentData[];  // â† Ğ’ĞºĞ»Ğ°Ğ´ĞµĞ½Ñ– Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–
}
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 4: Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ÑÑ‚Ğ°Ğ½ Ğ´Ğ»Ñ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–

```typescript
const [replyingTo, setReplyingTo] = useState<{
  commentId: string;
  userName: string;
} | null>(null);
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 5: Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ Ğ³Ñ€ÑƒĞ¿ÑƒĞ²Ğ°Ğ½Ğ½Ñ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ²

```typescript
const groupCommentsWithReplies = (comments: CommentData[]): CommentData[] => {
  // Ğ¡Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºÑƒ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ”Ğ¼Ğ¾ ĞºĞ¾Ñ€ĞµĞ½ĞµĞ²Ñ– ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ– (parent_id = null)
  const rootComments = comments.filter(c => !c.parent_id);
  
  // Ğ”Ğ¾Ğ´Ğ°Ñ”Ğ¼Ğ¾ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ– Ğ´Ğ¾ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ñ€ĞµĞ½ĞµĞ²Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ
  return rootComments.map(root => ({
    ...root,
    replies: comments.filter(c => c.parent_id === root.id)
  }));
};
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 6: ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ğ·Ğ°Ğ¿Ğ¸Ñ‚ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ²

```typescript
const loadRecentComments = async () => {
  // Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶ÑƒÑ”Ğ¼Ğ¾ Ğ²ÑÑ– ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ– (Ğ²ĞºĞ»ÑÑ‡Ğ½Ğ¾ Ğ· Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑĞ¼Ğ¸)
  const { data: commentsData } = await supabase
    .from('comments')
    .select('*')
    .eq('post_id', id)
    .order('created_at', { ascending: true }); // Ğ’Ñ–Ğ´ ÑÑ‚Ğ°Ñ€Ğ¸Ñ… Ğ´Ğ¾ Ğ½Ğ¾Ğ²Ğ¸Ñ…

  // Ğ“Ñ€ÑƒĞ¿ÑƒÑ”Ğ¼Ğ¾ Ğ² Ñ–Ñ”Ñ€Ğ°Ñ€Ñ…Ñ–Ñ
  const grouped = groupCommentsWithReplies(commentsWithUsers);
  setRecentComments(grouped.slice(-2)); // ĞÑÑ‚Ğ°Ğ½Ğ½Ñ– 2 ĞºĞ¾Ñ€ĞµĞ½ĞµĞ²Ñ–
};
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 7: ĞĞ½Ğ¾Ğ²Ğ¸Ñ‚Ğ¸ Ñ„Ğ¾Ñ€Ğ¼Ñƒ Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ

```typescript
const handleCommentSubmit = async () => {
  await supabase.from('comments').insert({
    post_id: id,
    user_id: authUser.id,
    content: commentText.trim(),
    parent_id: replyingTo?.commentId || null  // â† Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ parent_id
  });
  
  setReplyingTo(null);
  setCommentText("");
};
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 8: UI Ğ´Ğ»Ñ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ Ğ· Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑĞ¼Ğ¸

```tsx
{/* ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ¾Ğ´Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ */}
const CommentItem = ({ comment, depth = 0 }: { comment: CommentData; depth?: number }) => (
  <div className={cn("flex items-start gap-2", depth > 0 && "ml-8 mt-2")}>
    <Avatar className="h-6 w-6">
      <AvatarImage src={comment.user?.avatar_url} />
      <AvatarFallback>{comment.user?.full_name?.[0]}</AvatarFallback>
    </Avatar>
    <div className="flex-1">
      <div className="bg-muted/50 rounded-2xl px-3 py-1.5">
        <span className="font-semibold text-xs">{comment.user?.full_name}</span>
        <p className="text-sm">{comment.content}</p>
      </div>
      
      {/* Ğ”Ñ–Ñ— Ğ¿Ñ–Ğ´ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€ĞµĞ¼ */}
      <div className="flex items-center gap-3 mt-1 text-xs text-muted-foreground">
        <span>{formatTimeAgo(comment.created_at)}</span>
        <button className="hover:underline font-medium">ĞŸĞ¾Ğ´Ğ¾Ğ±Ğ°Ñ”Ñ‚ÑŒÑÑ</button>
        <button 
          onClick={() => setReplyingTo({ commentId: comment.id, userName: comment.user?.full_name })}
          className="hover:underline font-medium"
        >
          Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–ÑÑ‚Ğ¸
        </button>
      </div>
      
      {/* Ğ’ĞºĞ»Ğ°Ğ´ĞµĞ½Ñ– Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ– */}
      {comment.replies?.map(reply => (
        <CommentItem key={reply.id} comment={reply} depth={depth + 1} />
      ))}
    </div>
  </div>
);
```

---

### Ğ§Ğ°ÑÑ‚Ğ¸Ğ½Ğ° 9: ĞŸĞ¾ĞºĞ°Ğ·ÑƒĞ²Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ¼Ñƒ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ñ”Ğ¼Ğ¾

```tsx
{replyingTo && (
  <div className="flex items-center gap-2 text-xs text-muted-foreground mb-1">
    <span>Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ Ğ´Ğ»Ñ {replyingTo.userName}</span>
    <button onClick={() => setReplyingTo(null)} className="text-destructive">
      âœ• Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸
    </button>
  </div>
)}
```

---

### Ğ¤Ğ°Ğ¹Ğ»Ğ¸ Ğ´Ğ»Ñ Ñ€ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ

| Ğ¤Ğ°Ğ¹Ğ» | Ğ—Ğ¼Ñ–Ğ½Ğ¸ |
|------|-------|
| ĞœÑ–Ğ³Ñ€Ğ°Ñ†Ñ–Ñ SQL | Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ ĞºĞ¾Ğ»Ğ¾Ğ½ĞºÑƒ `parent_id` |
| `src/integrations/supabase/types.ts` | Ğ”Ğ¾Ğ´Ğ°Ñ‚Ğ¸ `parent_id` Ğ´Ğ¾ Ñ‚Ğ¸Ğ¿Ñ–Ğ² comments |
| `src/components/feed/PostCard.tsx` | ĞŸĞ¾Ğ²Ğ½Ğ° Ñ€ĞµĞ°Ğ»Ñ–Ğ·Ğ°Ñ†Ñ–Ñ Ğ²ĞºĞ»Ğ°Ğ´ĞµĞ½Ğ¸Ñ… ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ² |

---

### ĞÑ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

1. ĞŸÑ–Ğ´ ĞºĞ¾Ğ¶Ğ½Ğ¸Ğ¼ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€ĞµĞ¼ Ñ” ĞºĞ½Ğ¾Ğ¿ĞºĞ° "Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–ÑÑ‚Ğ¸"
2. Ğ’Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ– Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑÑ‚ÑŒÑÑ Ğ· Ğ²Ñ–Ğ´ÑÑ‚ÑƒĞ¿Ğ¾Ğ¼ Ğ¿Ñ–Ğ´ Ğ±Ğ°Ñ‚ÑŒĞºÑ–Ğ²ÑÑŒĞºĞ¸Ğ¼ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€ĞµĞ¼
3. ĞŸÑ€Ğ¸ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ– Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑ”Ñ‚ÑŒÑÑ "@Ñ–Ğ¼'Ñ" ĞºĞ¾Ğ¼Ñƒ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ°Ñ”Ğ¼Ğ¾
4. ĞĞ²Ñ‚Ğ¾Ñ€ Ğ¿Ğ¾ÑÑ‚Ğ° Ğ¿Ğ¾Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ±ĞµĞ¹Ğ´Ğ¶ĞµĞ¼ "ĞĞ²Ñ‚Ğ¾Ñ€" (ÑĞº Ğ½Ğ° ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚Ñ–)
5. Ğ†Ñ”Ñ€Ğ°Ñ€Ñ…Ñ–Ñ ĞºĞ¾Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ñ–Ğ² Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ”Ñ‚ÑŒÑÑ Ñƒ Ğ‘Ğ” Ñ‡ĞµÑ€ĞµĞ· `parent_id`

